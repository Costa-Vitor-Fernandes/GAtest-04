name: Version Check
on: [pull_request]

jobs:
  check:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    
    steps:
      - uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          types: feat fix docs style refactor perf test build ci chore revert
          headerPattern: '^(\w+)(?:\([^)]+\))?!?:\s.+'
          headerPatternCorrespondence: ['type']
      
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }

      - id: calc
        run: node .github/scripts/version.cjs
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
          BASE_TAG: 4a112c754abba0bb893ae3d22c1b5e825c1e1584
          BASE_VERSION: 0.0.1

      - uses: peter-evans/create-or-update-comment@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            **ðŸ“¦ PrÃ³xima versÃ£o:** `${{ steps.calc.outputs.next }}`
            
            ${{ steps.calc.outputs.analysis }}
            
            ---
            *Ãšltima tag: ${{ steps.calc.outputs.last }}*
          edit-mode: replace
          comment-tag: version-preview